# Running python

Python is normally referred to as an interpreted language. We don't have to compile our code before we can run it, but our Python code needs to be converted into binary before the machine can run anything.
So what *actually* happens at runtime? What does the Python interpreter do when we run a script?

As we'll see, what we mean when we talk about 'Python' can be broken down into two distinct concepts:
1. Python language: the syntactic & semantic rules that specify whether the contents of a `.py` file constitute valid Python code.
2. Python interpreter/runtime: a software package containing the components & architecture to run the contents of `.py` files.

Whilst the language is platform agnostic, the interpreter that is bundled with your installation is platform-specific.

## The anatomy of the Python interpreter

We should start by noting that there isn't just one Python interpreter; there are multiple implementations of interpreters that can run Python code.

**CPython** is the standard Python interpreter. If a different interpreter isn't explicitly mentioned, assume you're talking about CPython.
It's called CPython because it's implemented in C...

The interpreter passes through 2 steps in turning our Python source code into binary:
1. "Compiler": compiles python to byte code
2. "Python virtual machine": converts byte code into binary

### Compiling to byte code

1. Parse the source code into a parse tree
2. Transform the parse tree into an Abstract Syntax Tree (AST)
3. Transform the AST into a Control Flow Graph (CFG)
4. Produce byte code from the CFG

NB. byte code is platform independent.

When a Python script is executed, the byte code is generated **in-memory**, and then cleared once the program exits.

However, whenever a module is imported, its byte code is generated and stored in a `.pyc` file - meaning it is available the next time that module is imported. As a result, the byte code doesn't need to be regenerated each time it is used and the compilation phase runs faster.

The next time you run this code, Python will check that the source code hasn't changed since the byte code was generated and that it was generated by the same Python version.

### The Python virtual machine (PVM)

A code loop that iterates over byte code instructions and converts them to binary.

## Python interpreter implementations

- CPython
- Jython
- Iron Python
- PyPy

### Jython

Written in Java & compiles python source code to Java byte code in order to run it in a Java Virtual Machine
Slower than CPython.
In the same way that CPython enables us to use Python to script C & C++ components, Jython seeks to enable users to use Python to script Java components

### Iron Python

Written in C# and compiles byte code that runs in a .NET virtual machine.

### PyPy

Written in Python! (the interpreter is written in RPython - a subset of Python)
Uses JIT compilation and typically runs faster than CPython as a result - especially on repetitive tasks: in many benchmarks, PyPy completes tasks in 1/5th the time it takes CPython.
However, there are (at least) 2 downsides to consider:
1. Slower start-up time
2. Because the interpreter is written in Python, PyPy isn't able to leverage some packages that rely on C-extensions (eg. NumPy) 


## Resources

[Learning Python (O'Reilly)](https://www.oreilly.com/library/view/learning-python-5th/9781449355722/)
[Anthony Shaw's benchmarking results](https://hackernoon.com/which-is-the-fastest-version-of-python-2ae7c61a6b2b)